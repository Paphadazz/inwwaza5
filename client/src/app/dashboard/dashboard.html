<div class="dashboard-container">
    <div class="dashboard-header">
        <h1 class="page-title">
            <mat-icon>dashboard</mat-icon>
            Mission Summary
        </h1>
    </div>

    @if (loading()) {
    <div class="loading-state">
        <mat-icon>hourglass_empty</mat-icon>
        <p>Loading dashboard...</p>
    </div>
    } @else if (summary()) {
    <div class="stats-grid">
        <div class="stat-card created">
            <div class="icon-wrapper">
                <mat-icon>military_tech</mat-icon>
            </div>
            <div class="stat-content">
                <h2 class="stat-value">{{summary()!.created_missions_count}}</h2>
                <p class="stat-label">Created Missions</p>
            </div>
        </div>

        <div class="stat-card joined">
            <div class="icon-wrapper">
                <mat-icon>groups</mat-icon>
            </div>
            <div class="stat-content">
                <h2 class="stat-value">{{summary()!.joined_missions_count}}</h2>
                <p class="stat-label">Joined Missions</p>
            </div>
        </div>

        <div class="stat-card active">
            <div class="icon-wrapper">
                <mat-icon>trending_up</mat-icon>
            </div>
            <div class="stat-content">
                <h2 class="stat-value">{{summary()!.active_missions_count}}</h2>
                <p class="stat-label">Active Missions</p>
            </div>
        </div>

        <div class="stat-card completed">
            <div class="icon-wrapper">
                <mat-icon>check_circle</mat-icon>
            </div>
            <div class="stat-content">
                <h2 class="stat-value">{{summary()!.completed_missions_count}}</h2>
                <p class="stat-label">Completed Missions</p>
            </div>
        </div>
    </div>

    <div class="chart-section minimalist-analytics">
        <div class="chart-header">
            <h2 class="section-title">
                <mat-icon>insights</mat-icon>
                Mission Trends (Current Year)
            </h2>
            <div class="chart-legend">
                <span class="legend-item created">Created</span>
                <span class="legend-item joined">Joined</span>
                <span class="legend-item completed">Completed</span>
                <span class="legend-item active">Active</span>
            </div>
        </div>

        <div class="chart-container">
            <!-- Y-Axis Labels -->
            <div class="y-axis-labels">
                @for (label of getYLabels(); track label) {
                <span>{{label}}</span>
                }
            </div>

            <div class="svg-wrapper">
                <svg viewBox="0 0 1000 300" preserveAspectRatio="none" class="trend-chart">
                    <!-- Background Grid -->
                    <g class="grid-lines">
                        <!-- Horizontal Grid Lines -->
                        @for (label of getYLabels(); track label) {
                        <line x1="40" [attr.y1]="getCoordinates(0, label).y" x2="960"
                            [attr.y2]="getCoordinates(0, label).y" class="grid-line horizontal" />
                        }

                        <!-- Vertical Grid Lines (Months) -->
                        @for (month of months; track month; let i = $index) {
                        <line [attr.x1]="getCoordinates(i, 0).x" y1="40" [attr.x2]="getCoordinates(i, 0).x" y2="260"
                            class="grid-line vertical" />
                        }
                    </g>

                    <!-- Trend Lines -->
                    <path [attr.d]="getSmoothPath('created')" class="chart-path smooth created" />
                    <path [attr.d]="getSmoothPath('joined')" class="chart-path smooth joined" />
                    <path [attr.d]="getSmoothPath('completed')" class="chart-path smooth completed" />
                    <path [attr.d]="getSmoothPath('active')" class="chart-path smooth active" />

                    <!-- Data Points -->
                    @let data = summary()!.chart_data;
                    <g class="data-points">
                        @for (p of data; track p.date; let i = $index) {
                        <circle [attr.cx]="getCoordinates(i, p.created, 'created').x"
                            [attr.cy]="getCoordinates(i, p.created, 'created').y" r="4" class="point created" />
                        <circle [attr.cx]="getCoordinates(i, p.joined, 'joined').x"
                            [attr.cy]="getCoordinates(i, p.joined, 'joined').y" r="4" class="point joined" />
                        <circle [attr.cx]="getCoordinates(i, p.completed, 'completed').x"
                            [attr.cy]="getCoordinates(i, p.completed, 'completed').y" r="4" class="point completed" />
                        <circle [attr.cx]="getCoordinates(i, p.active, 'active').x"
                            [attr.cy]="getCoordinates(i, p.active, 'active').y" r="4" class="point active" />
                        }
                    </g>
                </svg>
            </div>
        </div>

        <div class="chart-footer">
            <div class="x-axis-labels">
                @for (month of months; track month) {
                <span>{{month}}</span>
                }
            </div>
        </div>
    </div>
    } @else if (!loading() && !summary()) {
    <div class="empty-state">
        <mat-icon>sentiment_dissatisfied</mat-icon>
        <p>No missions yet.</p>
    </div>
    }
</div>